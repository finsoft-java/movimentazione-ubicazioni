<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="google" content="notranslate">
        <meta name="viewport" content="width=device-width, user-scalable=no,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">

        <title>Movimentazione Ubicazioni</title>
        <link rel="stylesheet" href="assets/css/bootstrap.min.css">
        <link rel="stylesheet" href="assets/css/style.css?v=6">
        <link rel="stylesheet" href="assets/css/all.css">
        <link rel="stylesheet" href="assets/css/fontawesome.css">
        <link rel="stylesheet" href="assets/css/v4-font-face.css">
    </head>
    <body>
        <div class="interrogaUbiOsai red">
            <div><a class="nav-link" style="text-transform: uppercase;" href="./index.html">Torna al Menu</a></div>
        </div>
        <h3 class="titleOsai">Interrogazione Ubicazione</h3>
        <div class="qrcode">
            <input type="password" class="form-control focus" id="qrcode" placeholder="QRCODE" aria-describedby="basic-addon2">
        </div>
        <div class="listaOsai">

        </div>
        <script src="assets/js/jquery-3.6.0.min.js"></script>
        <script src="assets/js/popper.min.js"></script>
        <script src="assets/js/bootstrap.min.js"></script>
        <script>
            $(document).ready(function(){
                $(".focus").focus();
                setInterval(function() {
                    console.log("Focusing esaurimento");
                    $("#qrcode").get(0).focus();
                }, 1000);
            });
            /**
            let i = 0;
            document.getElementById("qrcode").addEventListener("keyup", function(event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    i++;
                    barCode = $("#qrcode").val();
                    if(i == 1) {
                        sessionStorage.setItem('ubicazione', barCode);
                    }
                    if(i == 2) {
                        sessionStorage.setItem('articolo', barCode);
                    }
                    if(i == 3) {
                        sessionStorage.setItem('ubicazione-destinazione', barCode);
                        $("#qrcode").attr('disabled',true);
                    }
                }
            });
            */
            document.getElementById("qrcode").addEventListener("keyup", function(event) {
                if (event.keyCode === 13) {
                    $.get({
                        url: "./ws/Interrogazione.php?codUbicazione=" + $("#qrcode").val(),
                        dataType: 'json',
                        //headers: {
                         //   'Authorization': 'Bearer ' + sessionStorage.getItem('token')
                        //},
                        success: function(data, status) {
                            let dati = data["data"];
                            let datiStampati = "";
                            for(let i = 0; i < Object.keys(dati).length;i++){
                                datiStampati += "<p>Articolo: <strong>"+dati[i].ID_ARTICOLO+"</strong></p>";
                                datiStampati += "<p>Magazzino: <strong>"+dati[i].ID_MAGAZZINO+"</strong> | Quantita: <strong>"+dati[i].QTA_GIAC_PRM+" pz. </strong></p>";
                                datiStampati += "<hr/>";
                            }
                            $(".listaOsai").html(datiStampati);
                        }
                    });
                    //hide_errors();
                    $("#qrcode").attr("disabled", true);
                }
            });
        </script>
    </body>
</html>
